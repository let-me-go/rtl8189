#include "ddrc.h"
#include "pre_define.h"
void denali_ddrc_init (void)
{
	unsigned int reg;
   reg = read_reg(BASEADDR_DDRC_REG+0x1e*4);         //DENALI_CTL_30
   write_reg(BASEADDR_DDRC_REG+0x10*4, 0x00000000); //DENALI_CTL_16
   write_reg(BASEADDR_DDRC_REG+0x11*4, 0x00000100); //DENALI_CTL_17
   write_reg(BASEADDR_DDRC_REG+0x1a*4, 0x00010101); //DENALI_CTL_26
   write_reg(BASEADDR_DDRC_REG+0x1b*4, 0x01010101); //DENALI_CTL_27
   write_reg(BASEADDR_DDRC_REG+0x1c*4, 0x000f0f01); //DENALI_CTL_28

   write_reg(BASEADDR_DDRC_REG+0x1d*4, 0x0102010a); //DENALI_CTL_29: [27:24] CS_MAP = 1; [18:16] COLUMN_SIZE = 2 (12->10); [10:8] ADDR_PINS = 1 (15=>14); [3:0] APREBIT = a;

   write_reg(BASEADDR_DDRC_REG+0x1f*4, 0x01010101); //DENALI_CTL_31: [24] DDRII_SDRAM_MODE = 1(DDR2); [16] EIGHT_BANK_MODE = 1(Eight bank);

   write_reg(BASEADDR_DDRC_REG+0x20*4, 0x00000100); //DENALI_CTL_32: [8] REDUC = 1; [0] REG_DIMM_ENABLE = 0;
   write_reg(BASEADDR_DDRC_REG+0x21*4, 0x00000100); //DENALI_CTL_33
   write_reg(BASEADDR_DDRC_REG+0x22*4, 0x01010101); //DENALI_CTL_34
   write_reg(BASEADDR_DDRC_REG+0x23*4, 0x00000002); //DENALI_CTL_35
   write_reg(BASEADDR_DDRC_REG+0x24*4, 0x01010100); //DENALI_CTL_36

	 write_reg(BASEADDR_DDRC_REG+0x25*4, 0x0f020403); //DENALI_CTL_37 : [27:24] CASLAT_LIN_GATE = f ??; [19:16] CASLAT_LIN =C??; [10:8] CASLAT = 4; [2:0] wrlat = 3
   write_reg(BASEADDR_DDRC_REG+0x26*4, 0x08000002); //DENALI_CTL_38: [27:24] TDAL (WR + tRP) = 8; [23:8] TCPD = 00??; [2:0] TCKE = 2;
   write_reg(BASEADDR_DDRC_REG+0x27*4, 0x14040000); //DENALI_CTL_39: [28:24] TFAW = 20; [18:16] TEMRS = 4; [15:0]
   write_reg(BASEADDR_DDRC_REG+0x28*4, 0x04000022); //DENALI_CTL_40: [28:24] TMRD = 4; TINIT
   write_reg(BASEADDR_DDRC_REG+0x29*4, 0x0006041a); //DENALI_CTL_41: [31:16] TPDEX = 6; [15:8] TRCD_INT = 4; [4:0] TRC = 26
   write_reg(BASEADDR_DDRC_REG+0x2a*4, 0x001fff12); //DENALI_CTL_42: [23:8] TRAS_MAX = 0x1FFF; [7:0] TRAS_MIN = 18
   write_reg(BASEADDR_DDRC_REG+0x2b*4, 0x04832100); //DENALI_CTL_43: [27:24] TRP = 4; [23:16] TRFC = 0x83; [13:0] TREF =
   write_reg(BASEADDR_DDRC_REG+0x2c*4, 0x05040303); //DENALI_CTL_44:[26:24]tWTR = 5;[19:16] TWR_INT = 4; [10:8] TRTP= 3;[2:0] TRRD= 3
   write_reg(BASEADDR_DDRC_REG+0x2d*4, 0x00d70087); //DENALI_CTL_45: [31:16] TXSR = ; TXSNR: [15:0] = 0x87;
   write_reg(BASEADDR_DDRC_REG+0x2e*4, 0x00000000); //DENALI_CTL_46: obsolete
   write_reg(BASEADDR_DDRC_REG+0x2f*4, 0x00000000); //DENALI_CTL_47: obsolete

   write_reg(BASEADDR_DDRC_REG+0x30*4, 0x00016400); //DENALI_CTL_48
   write_reg(BASEADDR_DDRC_REG+0x31*4, 0xffff0000); //DENALI_CTL_49
   write_reg(BASEADDR_DDRC_REG+0x32*4, 0x00016400); //DENALI_CTL_50
   write_reg(BASEADDR_DDRC_REG+0x33*4, 0xffff0000); //DENALI_CTL_51
   write_reg(BASEADDR_DDRC_REG+0x34*4, 0x00016400); //DENALI_CTL_52
   write_reg(BASEADDR_DDRC_REG+0x35*4, 0xffff0000); //DENALI_CTL_53

   write_reg(BASEADDR_DDRC_REG+0x36*4, 0x00016400); //DENALI_CTL_54
   write_reg(BASEADDR_DDRC_REG+0x37*4, 0xffff0000); //DENALI_CTL_55
   write_reg(BASEADDR_DDRC_REG+0x38*4, 0x00000003); //DENALI_CTL_56
   write_reg(BASEADDR_DDRC_REG+0x39*4, 0x00000000); //DENALI_CTL_57
   write_reg(BASEADDR_DDRC_REG+0x3a*4, 0x00000083); //DENALI_CTL_58
   write_reg(BASEADDR_DDRC_REG+0x43*4, 0x01000002); //DENALI_CTL_67
   write_reg(BASEADDR_DDRC_REG+0x45*4, 0x00000200); //DENALI_CTL_69
   write_reg(BASEADDR_DDRC_REG+0x46*4, 0x00000006); //DENALI_CTL_70
   write_reg(BASEADDR_DDRC_REG+0x47*4, 0x04001607); //DENALI_CTL_71
   write_reg(BASEADDR_DDRC_REG+0x48*4, 0x04001607); //DENALI_CTL_72

   write_reg(BASEADDR_DDRC_REG+0x4b*4, 0x07800002); //DENALI_CTL_75
   write_reg(BASEADDR_DDRC_REG+0x4c*4, 0x07800002); //DENALI_CTL_76
   write_reg(BASEADDR_DDRC_REG+0x4f*4, 0x00000005); //DENALI_CTL_79
   write_reg(BASEADDR_DDRC_REG+0x50*4, 0x00000000); //DENALI_CTL_80
   write_reg(BASEADDR_DDRC_REG+0x51*4, 0x00000000); //DENALI_CTL_81
   write_reg(BASEADDR_DDRC_REG+0x52*4, 0x01000201); //DENALI_CTL_82

   write_reg(BASEADDR_DDRC_REG+0x53*4, 0x08040201); //DENALI_CTL_83
   write_reg(BASEADDR_DDRC_REG+0x54*4, 0x08040201); //DENALI_CTL_84
   write_reg(BASEADDR_DDRC_REG+0x55*4, 0x000f1133); //DENALI_CTL_85
   write_reg(BASEADDR_DDRC_REG+0x57*4, 0x000f1e06); //DENALI_CTL_87

   write_reg(BASEADDR_DDRC_REG+0x58*4, 0x000f1e06); //DENALI_CTL_88
   write_reg(BASEADDR_DDRC_REG+0x5b*4, 0x000f2004); //DENALI_CTL_91
   write_reg(BASEADDR_DDRC_REG+0x5c*4, 0x000f2004); //DENALI_CTL_92





  //enable the controller
	reg = read_reg(BASEADDR_DDRC_REG+0x10*4);      //DENALI_CTL_16
	write_reg(BASEADDR_DDRC_REG+0x10*4, reg|0x1);  //DENALI_CTL_16

 // wait dfi_init_complete,
	do {
		reg = read_reg(BASEADDR_DDRC_REG+0x3a*4);   // DENALI_CTL_58 : [4] DRAM initialization complete
	} while( (reg & 0x100000) != 0x100000);

}
